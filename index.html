<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Мгновенное портфолио</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Портфолио, которое говорит за тебя. Мгновенно. Без регистрации, без подписок." />
  <style>
    :root {
      --bg: #f5f7fa;
      --card-bg: #ffffff;
      --primary: #2563eb;
      --text: #1f2d3a;
      --radius: 10px;
      --shadow: 0 20px 40px -10px rgba(31,45,58,.08);
      --transition: .35s cubic-bezier(.4,.2,.2,1);
      --font-stack: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
    }
    *{box-sizing:border-box;}
    html {scroll-behavior: smooth;}
    body {margin:0;background:var(--bg);font-family: var(--font-stack);color: var(--text);-webkit-font-smoothing:antialiased;line-height:1.45;}
    a{color:var(--primary);text-decoration:none;}
    img{max-width:100%;display:block;border-radius:6px;}
    button{cursor:pointer;border:none;background:none;font:inherit;position:relative;overflow:hidden;}
    .container{max-width:1120px;margin:0 auto;padding:0 16px;}
    .flex{display:flex;}
    .space-between{justify-content:space-between;}
    .center{align-items:center;display:flex;}
    .gap{gap:1rem;}
    h1{margin:0;font-size:2.4rem;font-weight:700;}
    h2{margin:0;font-size:1.5rem;font-weight:600;}
    p{margin:0 0 1em;font-size:1rem;}
    .small{font-size:.85rem;color:#556678;}
    .btn-primary{background:var(--primary);color:#fff;padding:.75rem 1.5rem;border-radius:8px;font-weight:600;display:inline-flex;align-items:center;gap:.5rem;transition:var(--transition);}
    .btn-primary:hover{filter:brightness(1.05);}
    .btn-secondary{padding:.65rem 1.2rem;border-radius:8px;border:1px solid rgba(37,99,235,.4);font-weight:600;display:inline-flex;align-items:center;gap:.4rem;transition:var(--transition);background:#fff;}
    .btn-secondary:hover{background:rgba(37,99,235,.05);}
    .card{background:var(--card-bg);border-radius:var(--radius);padding:1.25rem;position:relative;overflow:hidden;box-shadow:var(--shadow);transition:transform .35s,var(--transition);}
    .card:hover{transform:translateY(-3px);}
    .inline-edit{outline:2px dashed transparent;transition:var(--transition);min-height:1.2em;display:inline-block;}
    .inline-edit:focus{outline:2px dashed var(--primary);background:rgba(37,99,235,.04);}
    .template-filter{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:8px;}
    .template-filter button{padding:.5rem 1rem;border-radius:999px;border:1px solid #d4d9e2;background:#fff;font-size:.75rem;font-weight:600;transition:var(--transition);}
    .template-filter button.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .template-card{position:relative;overflow:hidden;border-radius:12px;cursor:pointer;display:flex;flex-direction:column;justify-content:space-between;min-height:180px;transition:all .3s;}
    .template-card.selected{outline:3px solid var(--primary);}
    .badge{background:var(--primary);color:#fff;padding:6px 14px;border-radius:999px;font-size:.65rem;display:inline-block;margin-bottom:6px;}
    .pill{background:#eef2f7;border-radius:999px;padding:6px 16px;font-size:.65rem;display:inline-block;margin-right:6px;}
    .editor{display:grid;grid-template-columns:1fr 2fr 1fr;gap:20px;margin-top:40px;}
    .panel{background:#fff;border-radius:12px;padding:16px;position:sticky;top:80px;max-height:calc(100vh - 120px);overflow:auto;}
    .section{background:var(--card-bg);border-radius:10px;margin-bottom:16px;position:relative;overflow:hidden;transition:all .3s;}
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
    .section-controls button{margin-left:6px;font-size:.85rem;padding:6px 10px;border-radius:6px;border:1px solid #d4d9e2;background:#fff;transition:all .2s;}
    .project-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px;margin-top:10px;}
    .project-card{background:var(--card-bg);border-radius:10px;position:relative;padding:12px;display:flex;flex-direction:column;gap:6px;box-shadow:0 18px 45px -8px rgba(31,45,58,.08);}
    .project-thumb{width:100%;height:120px;object-fit:cover;border-radius:8px;background:#eceef3;}
    .link-input{background:#f9fafd;border:1px solid #d4d9e2;border-radius:6px;padding:6px;font-size:.85rem;width:100%;margin-top:4px;}
    .color-row{display:flex;gap:12px;flex-wrap:wrap;margin-top:6px;}
    .color-box{display:flex;flex-direction:column;gap:4px;}
    .footer{margin-top:60px;padding:50px 0;font-size:.8rem;color:#556678;}
    .footer .row{display:flex;flex-wrap:wrap;gap:30px;}
    .footer-col{flex:1;min-width:160px;}
    .indicator{position:fixed;top:14px;right:14px;background:rgba(37,99,235,.9);color:#fff;padding:10px 16px;border-radius:999px;font-size:.75rem;display:flex;align-items:center;gap:6px;box-shadow:0 30px 60px -10px rgba(31,45,58,.25);opacity:0;transform:translateY(-6px);transition:all .3s;}
    .show{opacity:1;transform:translateY(0);}
    .template-variant-classic{--template-bg:#fff;--template-radius:10px;}
    .template-variant-minimal{--template-bg:transparent;--template-radius:0;}
    .template-variant-showcase .project-card{border:2px solid var(--primary);}
    .template-label{position:absolute;top:10px;left:10px;background:rgba(255,255,255,.95);padding:4px 10px;border-radius:6px;font-size:.55rem;font-weight:600;box-shadow:0 10px 30px -5px rgba(31,45,58,.1);}
    .smooth{transition:all .35s var(--transition);}
    .hover-lift{transition:transform .3s;will-change:transform;}
    .hover-lift:hover{transform:translateY(-2px);}
    .theme-controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;}
    .thumbnail{border-radius:6px;overflow:hidden;background:#f0f4f9;min-height:100px;display:flex;align-items:center;justify-content:center;font-size:.9rem;color:#556678;}
    .flex-wrap{display:flex;flex-wrap:wrap;gap:10px;}
    .link-style{color:var(--primary);}
    .photo-thumb{width:100%;border-radius:6px;margin-top:6px;}
  </style>
</head>
<body>

  <!-- индикатор сохранения -->
  <div id="savedIndicator" class="indicator">Сохранено ✓</div>

  <!-- HEADER -->
  <header class="container" style="padding:24px 0;">
    <div class="flex space-between" style="flex-wrap:wrap;">
      <div class="center" style="gap:16px;flex-wrap:wrap;">
        <div style="font-weight:700;font-size:1.1rem;">InstantPortfolio</div>
        <div class="small">Без регистрации. Без подписок. Ссылка готова сразу.</div>
      </div>
      <div class="flex gap" style="flex-wrap:wrap;">
        <button class="btn-secondary" onclick="scrollToGallery()">Посмотреть примеры</button>
        <button class="btn-primary" onclick="createDraft()">Создать портфолио</button>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="container" style="margin-top:8px;">
    <div class="flex" style="gap:40px;flex-wrap:wrap;">
      <div style="flex:1;min-width:280px;">
        <h1>Портфолио, которое говорит за тебя. Мгновенно.</h1>
        <p>Выбери шаблон, настрой, добавь фото и ссылки — поделись. Никаких форм, никаких обязательств.</p>
        <div class="flex gap" style="margin-top:14px;">
          <button class="btn-primary" onclick="createDraft()">Начать сейчас</button>
          <button class="btn-secondary" onclick="scrollToGallery()">Шаблоны</button>
        </div>
        <div class="small" style="margin-top:10px;">Гостевой драфт сохраняется локально. Ссылка отражает всё — делись сразу.</div>
      </div>
      <div style="flex:1;min-width:260px;position:relative;">
        <div class="card">
          <div style="display:flex;gap:12px;align-items:start;">
            <div style="flex:1;">
              <div style="background:rgba(37,99,235,.1);height:12px;width:70%;border-radius:5px;margin-bottom:8px;"></div>
              <div style="background:rgba(37,99,235,.05);height:10px;width:50%;border-radius:5px;margin-bottom:12px;"></div>
              <div style="display:flex;gap:8px;margin-top:6px;">
                <div style="background:#eef3fb;height:50px;flex:1;border-radius:6px;"></div>
                <div style="background:#eef3fb;height:50px;flex:1;border-radius:6px;"></div>
              </div>
            </div>
            <div style="width:100px;">
              <div style="background:#f0f4f9;height:100px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:.8rem;color:#556678;">Preview</div>
            </div>
          </div>
          <div class="badge" style="position:absolute;top:12px;right:12px;">Пример</div>
        </div>
      </div>
    </div>
  </section>

  <!-- WHY IT WORKS -->
  <div class="container" style="margin-top:40px;">
    <div style="text-align:center;max-width:900px;margin:0 auto;">
      <h2>Почему это работает</h2>
      <p class="small">Быстро, выразительно, без барьеров: шаблон → настройка → шаринг.</p>
    </div>
    <div class="flex" style="margin-top:24px;gap:16px;flex-wrap:wrap;">
      <div class="card" style="flex:1;min-width:220px;">
        <div class="flex gap" style="align-items:start;">
          <div style="font-size:1.5rem;">⚡</div>
          <div>
            <div style="font-weight:600;">Мгновенно</div>
            <div class="small">Гостевой драфт без форм, результат сразу.</div>
          </div>
        </div>
      </div>
      <div class="card" style="flex:1;min-width:220px;">
        <div class="flex gap" style="align-items:start;">
          <div style="font-size:1.5rem;">🎨</div>
          <div>
            <div style="font-weight:600;">Дизайн</div>
            <div class="small">Кардинально разные шаблоны, адаптивные и выразительные.</div>
          </div>
        </div>
      </div>
      <div class="card" style="flex:1;min-width:220px;">
        <div class="flex gap" style="align-items:start;">
          <div style="font-size:1.5rem;">✏️</div>
          <div>
            <div style="font-weight:600;">Контроль</div>
            <div class="small">Изменяй цвета, добавляй фото, ссылки, редактируй тексты inline.</div>
          </div>
        </div>
      </div>
      <div class="card" style="flex:1;min-width:220px;">
        <div class="flex gap" style="align-items:start;">
          <div style="font-size:1.5rem;">🔗</div>
          <div>
            <div style="font-weight:600;">Шаринг</div>
            <div class="small">Публичная ссылка содержит всё состояние.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- GALLERY -->
  <div id="gallery" class="container" style="margin-top:60px;">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;">
      <div>
        <h2>Шаблоны</h2>
        <p class="small">Выбери стиль, который тебе подходит — кардинально отличающиеся по верстке и акцентам.</p>
      </div>
      <div class="template-filter">
        <button data-filter="all" class="active" onclick="filterTemplates('all')">Все</button>
        <button data-filter="classic" onclick="filterTemplates('classic')">Classic</button>
        <button data-filter="minimal" onclick="filterTemplates('minimal')">Minimal</button>
        <button data-filter="showcase" onclick="filterTemplates('showcase')">Showcase</button>
      </div>
    </div>
    <div id="templates" class="flex" style="flex-wrap:wrap;gap:16px;margin-top:16px;">
      <!-- Classic -->
      <div class="template-card card" data-type="classic" id="tpl-classic" onclick="selectTemplate('classic')" style="flex:1;min-width:260px;max-width:320px;">
        <div class="template-label">Classic</div>
        <div style="margin-bottom:8px;font-weight:600;">Традиционное резюме</div>
        <div class="small">Четкая структура, акцент на текст и контакты.</div>
        <div style="margin-top:10px;">
          <button class="btn-secondary" onclick="event.stopPropagation(); selectTemplate('classic'); createDraft();">Выбрать</button>
        </div>
      </div>
      <!-- Minimal -->
      <div class="template-card card" data-type="minimal" id="tpl-minimal" onclick="selectTemplate('minimal')" style="flex:1;min-width:260px;max-width:320px;">
        <div class="template-label">Minimal</div>
        <div style="margin-bottom:8px;font-weight:600;">Минимализм</div>
        <div class="small">Пустое пространство, тонкие акценты, простая типографика.</div>
        <div style="margin-top:10px;">
          <button class="btn-secondary" onclick="event.stopPropagation(); selectTemplate('minimal'); createDraft();">Выбрать</button>
        </div>
      </div>
      <!-- Showcase -->
      <div class="template-card card" data-type="showcase" id="tpl-showcase" onclick="selectTemplate('showcase')" style="flex:1;min-width:260px;max-width:320px;">
        <div class="template-label">Showcase</div>
        <div style="margin-bottom:8px;font-weight:600;">Портфолио с фото</div>
        <div class="small">Большие изображения, визуальный фокус, демонстрация работ.</div>
        <div style="margin-top:10px;">
          <button class="btn-secondary" onclick="event.stopPropagation(); selectTemplate('showcase'); createDraft();">Выбрать</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Editor -->
  <div class="container" style="margin-top:50px;">
    <div class="editor" aria-label="Редактор портфолио">
      <!-- левая -->
      <div class="panel" style="flex:1;">
        <div class="small" style="margin-bottom:8px;font-weight:600;">Редактор</div>
        <div class="flex" style="gap:8px;flex-wrap:wrap;">
          <button class="btn-secondary" onclick="undo()">↺ Undo</button>
          <button class="btn-secondary" onclick="redo()">↻ Redo</button>
        </div>

        <div style="margin-top:16px;">
          <div class="small">Шаблон</div>
          <div class="flex-wrap" style="margin-top:6px;">
            <div class="btn-secondary" onclick="selectTemplate('classic')" style="font-size:.75rem;">Classic</div>
            <div class="btn-secondary" onclick="selectTemplate('minimal')" style="font-size:.75rem;">Minimal</div>
            <div class="btn-secondary" onclick="selectTemplate('showcase')" style="font-size:.75rem;">Showcase</div>
          </div>
        </div>

        <div style="margin-top:16px;">
          <div class="small">Цвета</div>
          <div class="color-row">
            <div class="color-box">
              <div class="small">Основной</div>
              <input type="color" id="primaryColor" value="#2563eb" onchange="updateColors()" aria-label="Основной цвет" />
            </div>
            <div class="color-box">
              <div class="small">Фон карточек</div>
              <input type="color" id="cardColor" value="#ffffff" onchange="updateColors()" aria-label="Фон карточек" />
            </div>
            <div class="color-box">
              <div class="small">Текст</div>
              <input type="color" id="textColor" value="#1f2d3a" onchange="updateColors()" aria-label="Цвет текста" />
            </div>
          </div>
        </div>

        <div style="margin-top:16px;">
          <div class="small">SEO</div>
          <div style="margin-top:4px;">
            <div class="small">Title</div>
            <input type="text" id="seoTitle" placeholder="Заголовок" style="width:100%;padding:8px;border:1px solid #d4d9e2;border-radius:6px;" />
            <div class="small" style="margin-top:8px;">Description</div>
            <textarea id="seoDesc" rows="2" placeholder="Описание" style="width:100%;padding:8px;border:1px solid #d4d9e2;border-radius:6px;"></textarea>
          </div>
        </div>

        <div style="margin-top:16px;">
          <div class="small">Шаринг</div>
          <div class="share-box">
            <input type="text" id="shareLink" readonly style="flex:1;padding:8px;border:1px solid #d4d9e2;border-radius:6px;font-size:.9rem;" />
            <button class="btn-primary" onclick="copyLink()">Копировать</button>
          </div>
          <div class="small">Ссылка отражает текущее состояние. Открытие показывает как посетитель.</div>
        </div>

        <div style="margin-top:16px;">
          <div class="small">Экспорт</div>
          <button class="btn-secondary" onclick="downloadStatic()">Скачать index.html</button>
          <div class="small" style="margin-top:4px;">Полностью автономное портфолио.</div>
        </div>
      </div>

      <!-- canvas -->
      <div class="panel" style="flex:2;">
        <div style="display:flex;justify-content:space-between;align-items:start;flex-wrap:wrap;gap:12px;">
          <div style="flex:1;min-width:220px;">
            <div contenteditable="true" class="inline-edit" id="title" style="font-size:1.9rem;font-weight:700;">Имя Фамилия</div>
            <div contenteditable="true" class="inline-edit small" id="subtitle" style="margin-top:4px;">Frontend-инженер, создаю интерфейсы</div>
          </div>
        </div>

        <!-- секции -->
        <div id="sectionsWrapper" style="margin-top:24px;">
          <!-- О себе -->
          <div class="section" data-key="about">
            <div class="section-header">
              <div>
                <div style="font-weight:600;">О себе</div>
                <div class="small">Короткое описание.</div>
              </div>
              <div class="section-controls">
                <button onclick="removeSection('about')">Удалить</button>
                <button onclick="duplicateSection('about')">Дублировать</button>
              </div>
            </div>
            <div contenteditable="true" class="inline-edit" id="about" style="padding:12px;border:1px solid #d4d9e2;border-radius:8px;">Привет! Я создаю портфолио быстро и красиво. Добавляй фото, ссылки, меняй цвета.</div>
          </div>

          <!-- Проекты -->
          <div class="section" data-key="projects">
            <div class="section-header">
              <div>
                <div style="font-weight:600;">Проекты</div>
                <div class="small">Добавь свои работы, фото и ссылки.</div>
              </div>
              <div class="section-controls">
                <button onclick="removeSection('projects')">Удалить</button>
                <button onclick="duplicateSection('projects')">Дублировать</button>
              </div>
            </div>
            <div id="projects" class="project-grid"></div>
            <div style="margin-top:10px;">
              <button class="btn-secondary" onclick="addProject()">+ Добавить проект</button>
            </div>
          </div>

          <!-- Контакты -->
          <div class="section" data-key="contacts">
            <div class="section-header">
              <div>
                <div style="font-weight:600;">Контакты</div>
                <div class="small">Где тебя найти.</div>
              </div>
              <div class="section-controls">
                <button onclick="removeSection('contacts')">Удалить</button>
                <button onclick="duplicateSection('contacts')">Дублировать</button>
              </div>
            </div>
            <div style="display:flex;gap:12px;flex-wrap:wrap;">
              <div style="flex:1;min-width:140px;">
                <div class="small">Email</div>
                <div contenteditable="true" class="inline-edit" id="contactEmail" style="padding:8px;border:1px solid #d4d9e2;border-radius:6px;">example@mail.com</div>
              </div>
              <div style="flex:1;min-width:140px;">
                <div class="small">GitHub</div>
                <div contenteditable="true" class="inline-edit" id="contactGithub" style="padding:8px;border:1px solid #d4d9e2;border-radius:6px;">github.com/username</div>
              </div>
              <div style="flex:1;min-width:140px;">
                <div class="small">Website</div>
                <div contenteditable="true" class="inline-edit" id="contactWebsite" style="padding:8px;border:1px solid #d4d9e2;border-radius:6px;">yourdomain.com</div>
              </div>
            </div>
          </div>
        </div>

        <div style="margin-top:14px;">
          <button class="btn-secondary" onclick="addSection()">+ Добавить секцию</button>
          <div class="small" style="margin-top:4px;">Перетаскивай секции (в будущем), дублируй, удаляй.</div>
        </div>
      </div>

      <!-- правая -->
      <div class="panel" style="flex:1;">
        <div class="small" style="margin-bottom:6px;font-weight:600;">Настройки</div>
        <div style="margin-top:10px;">
          <div class="small">Предварительный просмотр</div>
          <div class="flex" style="gap:8px;margin-top:6px;">
            <div class="card" style="flex:1;display:flex;align-items:center;justify-content:center;font-size:.9rem;">Мобильный</div>
            <div class="card" style="flex:1;display:flex;align-items:center;justify-content:center;font-size:.9rem;">Десктоп</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Кейсы -->
  <div class="container" style="margin-top:60px;">
    <div style="text-align:center;max-width:800px;margin:0 auto;">
      <h2>Живые кейсы</h2>
      <p class="small">Примеры пользователей, которые уже делятся портфолио.</p>
    </div>
    <div class="flex" style="gap:16px;flex-wrap:wrap;margin-top:14px;">
      <div class="card" style="flex:1;min-width:250px;">
        <div style="font-weight:600;">Anna Ivanova</div>
        <div class="small">Фриланс-дизайнер, UX/UI</div>
        <div style="margin-top:10px;"><button class="btn-secondary" onclick="alert('Открыть')">Открыть</button></div>
      </div>
      <div class="card" style="flex:1;min-width:250px;">
        <div style="font-weight:600;">Ivan Petrov</div>
        <div class="small">Frontend-инженер</div>
        <div style="margin-top:10px;"><button class="btn-secondary" onclick="alert('Открыть')">Открыть</button></div>
      </div>
      <div class="card" style="flex:1;min-width:250px;">
        <div style="font-weight:600;">Maria S.</div>
        <div class="small">Минималистичное резюме</div>
        <div style="margin-top:10px;"><button class="btn-secondary" onclick="alert('Открыть')">Открыть</button></div>
      </div>
    </div>
  </div>

  <!-- Доверие -->
  <div class="container" style="margin:60px 0;">
    <div class="card" style="display:flex;gap:24px;flex-wrap:wrap;">
      <div style="flex:1;min-width:220px;">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px;">
          <div style="font-size:1.7rem;">🛡️</div>
          <div>
            <div style="font-weight:600;">Без подписок</div>
            <div class="small">Создаёшь и сразу делишься. Никаких email, платежей и скрытых условий.</div>
          </div>
        </div>
        <div class="small">Сохраняется локально. Можно скачать финальное портфолио. Полностью автономно.</div>
      </div>
      <div style="flex:1;min-width:220px;">
        <div class="small">Что внутри:</div>
        <ul style="margin-top:6px;padding-left:16px;">
          <li>Inline-редактирование</li>
          <li>Изменение цветов</li>
          <li>Фото и ссылки</li>
          <li>Шаблоны с разным дизайном</li>
          <li>Публичная ссылка</li>
          <li>Экспорт в index.html</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="footer">
    <div class="container">
      <div class="row">
        <div class="footer-col">
          <div style="font-weight:700;margin-bottom:6px;">InstantPortfolio</div>
          <div class="small">Мгновенные портфолио. Без регистрации, без подписок.</div>
        </div>
        <div class="footer-col">
          <div style="font-weight:600;margin-bottom:6px;">Навигация</div>
          <div><a class="link" href="#gallery">Шаблоны</a></div>
          <div><a class="link" href="#about">О продукте</a></div>
          <div><a class="link" href="javascript:void(0)">FAQ</a></div>
          <div><a class="link" href="javascript:void(0)">Обратная связь</a></div>
        </div>
        <div class="footer-col">
          <div style="font-weight:600;margin-bottom:6px;">Право</div>
          <div><a class="link" href="javascript:void(0)">Политика приватности</a></div>
          <div><a class="link" href="javascript:void(0)">Условия</a></div>
        </div>
        <div class="footer-col">
          <div style="font-weight:600;margin-bottom:6px;">Контакты</div>
          <div class="small">support@instantportfolio.example</div>
        </div>
      </div>
      <div style="margin-top:30px;text-align:center;">
        <div class="small">&copy; <span id="footerYear"></span> InstantPortfolio. Все права защищены.</div>
      </div>
    </div>
  </div>

  <!-- утилиты сжатия (простая) -->
  <script>
    const LZString = {
      compressToEncodedURIComponent: input => encodeURIComponent(btoa(unescape(encodeURIComponent(input)))),
      decompressFromEncodedURIComponent: input => { try { return decodeURIComponent(escape(atob(decodeURIComponent(input)))); } catch { return null; } }
    };
  </script>

  <!-- логика -->
  <script>
    // State
    let state = {
      template: 'classic',
      colors: { primary: '#2563eb', card: '#ffffff', text: '#1f2d3a' },
      content: {
        title: 'Имя Фамилия',
        subtitle: 'Frontend-инженер',
        about: 'Привет! Я делаю портфолио быстро. Добавляй фото, ссылки и делись.',
        projects: [
          { name: 'Проект A', desc: 'Описание проекта', image: '', link: '' },
          { name: 'Проект B', desc: 'Еще один кейс', image: '', link: '' }
        ],
        contacts: { email: 'example@mail.com', github: 'github.com/username', website: 'yourdomain.com' },
        seo: { title: '', description: '' }
      }
    };
    let history = [], ptr = -1;
    const MAX_HISTORY = 30;
    let saveTimer = null;

    // Elements
    const titleEl = document.getElementById('title');
    const subtitleEl = document.getElementById('subtitle');
    const aboutEl = document.getElementById('about');
    const projectsEl = document.getElementById('projects');
    const shareLinkInput = document.getElementById('shareLink');
    const seoTitleEl = document.getElementById('seoTitle');
    const seoDescEl = document.getElementById('seoDesc');
    const indicator = document.getElementById('savedIndicator');
    const contactEmail = document.getElementById('contactEmail');
    const contactGithub = document.getElementById('contactGithub');
    const contactWebsite = document.getElementById('contactWebsite');
    const primaryColorInput = document.getElementById('primaryColor');
    const cardColorInput = document.getElementById('cardColor');
    const textColorInput = document.getElementById('textColor');
    const footerYear = document.getElementById('footerYear');

    function init(){
      footerYear.textContent = new Date().getFullYear();
      bindEditable([titleEl, subtitleEl, aboutEl]);
      bindEditableContacts();
      seoTitleEl.addEventListener('input', scheduleSave);
      seoDescEl.addEventListener('input', scheduleSave);
      primaryColorInput.addEventListener('input', updateColors);
      cardColorInput.addEventListener('input', updateColors);
      textColorInput.addEventListener('input', updateColors);
      loadState();
      render();
      updateShareLink();
    }

    function bindEditable(arr){
      arr.forEach(el=>{
        el.addEventListener('input', scheduleSave);
        el.addEventListener('blur', applyFromDOM);
      });
    }
    function bindEditableContacts(){
      [contactEmail, contactGithub, contactWebsite].forEach(el=>{
        el.addEventListener('input', scheduleSave);
        el.addEventListener('blur', applyFromDOM);
      });
    }

    function scheduleSave(){
      if(saveTimer) clearTimeout(saveTimer);
      saveTimer = setTimeout(()=>{
        applyFromDOM();
        pushHistory();
        persist();
        render();
        updateShareLink();
        showSaved();
      }, 300);
    }

    function showSaved(){
      indicator.classList.add('show');
      setTimeout(()=>indicator.classList.remove('show'), 1100);
    }

    function applyFromDOM(){
      state.content.title = titleEl.textContent.trim() || 'Имя Фамилия';
      state.content.subtitle = subtitleEl.textContent.trim() || 'Frontend-инженер';
      state.content.about = aboutEl.textContent.trim();
      // projects
      const cards = Array.from(document.querySelectorAll('.project-card'));
      state.content.projects = cards.map(card => {
        const name = card.querySelector('.proj-name')?.textContent.trim() || '';
        const desc = card.querySelector('.proj-desc')?.textContent.trim() || '';
        const link = card.querySelector('.proj-link')?.textContent.trim() || '';
        const imageEl = card.querySelector('.proj-img');
        const image = imageEl ? imageEl.getAttribute('data-src') || '' : '';
        return { name, desc, link, image };
      });
      // contacts
      state.content.contacts.email = contactEmail.textContent.replace(/^Email:\s*/i,'').trim();
      state.content.contacts.github = contactGithub.textContent.replace(/^GitHub:\s*/i,'').trim();
      state.content.contacts.website = contactWebsite.textContent.trim();
      // SEO
      state.content.seo.title = seoTitleEl.value;
      state.content.seo.description = seoDescEl.value;
    }

    function pushHistory(){
      const snap = JSON.stringify(state);
      if(ptr >=0 && history[ptr] === snap) return;
      history = history.slice(0, ptr+1);
      history.push(snap);
      if(history.length > MAX_HISTORY) history.shift();
      ptr = history.length -1;
    }

    function undo(){ if(ptr >0){ ptr--; state = JSON.parse(history[ptr]); render(); persist(); updateShareLink(); } }
    function redo(){ if(ptr < history.length-1){ ptr++; state = JSON.parse(history[ptr]); render(); persist(); updateShareLink(); } }

    function persist(){
      try{ localStorage.setItem('instant_portfolio_draft', JSON.stringify(state)); }catch{}
    }

    function loadState(){
      const hash = location.hash.slice(1);
      if(hash.startsWith('s=')){
        const compressed = hash.slice(2);
        try{
          const raw = LZString.decompressFromEncodedURIComponent(compressed);
          if(raw) state = JSON.parse(raw);
        }catch{}
      } else {
        try{
          const saved = localStorage.getItem('instant_portfolio_draft');
          if(saved) state = JSON.parse(saved);
        }catch{}
      }
      pushHistory();
    }

    function render(){
      // text
      titleEl.textContent = state.content.title;
      subtitleEl.textContent = state.content.subtitle;
      aboutEl.textContent = state.content.about;
      seoTitleEl.value = state.content.seo.title;
      seoDescEl.value = state.content.seo.description;
      contactEmail.textContent = 'Email: ' + state.content.contacts.email;
      contactGithub.textContent = 'GitHub: ' + state.content.contacts.github;
      contactWebsite.textContent = state.content.contacts.website;
      // colors
      document.documentElement.style.setProperty('--primary', state.colors.primary);
      document.documentElement.style.setProperty('--card-bg', state.colors.card);
      document.documentElement.style.setProperty('--text', state.colors.text);
      primaryColorInput.value = state.colors.primary;
      cardColorInput.value = state.colors.card;
      textColorInput.value = state.colors.text;
      // projects
      renderProjects();
      highlightTemplate();
    }

    function updateColors(){
      state.colors.primary = primaryColorInput.value;
      state.colors.card = cardColorInput.value;
      state.colors.text = textColorInput.value;
      render();
      scheduleSave();
    }

    function renderProjects(){
      projectsEl.innerHTML = '';
      state.content.projects.forEach((p,i)=>{
        const card = document.createElement('div');
        card.className = 'project-card';
        card.innerHTML = `
          <div contenteditable="true" class="proj-name" style="font-weight:600;">${escape(p.name)}</div>
          <div contenteditable="true" class="proj-desc small" style="margin-top:4px;">${escape(p.desc)}</div>
          <div contenteditable="true" class="proj-link link-style" style="margin-top:4px;">${escape(p.link)}</div>
          <div style="margin-top:8px;">
            <label style="font-size:.7rem;">Фото: <input type="file" accept="image/*" onchange="handleProjectImage(event, ${i})" /></label>
            ${p.image ? `<div class="photo-thumb-wrapper"><img class="proj-img photo-thumb" data-src="${escape(p.image)}" src="${escape(p.image)}" alt="Фото проекта" /></div>` : '<div class="photo-thumb-wrapper"></div>'}
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;">
            <button class="btn-secondary" onclick="removeProject(${i})">Удалить</button>
          </div>
        `;
        // bind
        card.querySelectorAll('[contenteditable]').forEach(el=>{
          el.addEventListener('input', scheduleSave);
          el.addEventListener('blur', applyFromDOM);
        });
        projectsEl.appendChild(card);
      });
    }

    function handleProjectImage(e,index){
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(ev){
        state.content.projects[index].image = ev.target.result;
        scheduleSave();
      };
      reader.readAsDataURL(file);
    }

    function addProject(){
      state.content.projects.push({ name: 'Новый проект', desc: 'Описание', image: '', link: '' });
      pushHistory();
      render();
      persist();
      updateShareLink();
    }
    function removeProject(i){
      state.content.projects.splice(i,1);
      pushHistory();
      render();
      persist();
      updateShareLink();
    }

    function selectTemplate(name){
      state.template = name;
      highlightTemplate();
      scheduleSave();
    }

    function highlightTemplate(){
      ['classic','minimal','showcase'].forEach(t=>{
        const el = document.getElementById('tpl-' + t);
        if(!el) return;
        if(state.template === t) el.classList.add('selected');
        else el.classList.remove('selected');
      });
      // apply variant classes to body for visual differences
      document.body.classList.remove('template-variant-classic','template-variant-minimal','template-variant-showcase');
      if(state.template==='classic') document.body.classList.add('template-variant-classic');
      if(state.template==='minimal') document.body.classList.add('template-variant-minimal');
      if(state.template==='showcase') document.body.classList.add('template-variant-showcase');
    }

    function updateShareLink(){
      const s = LZString.compressToEncodedURIComponent(JSON.stringify(state));
      const url = `${location.origin}${location.pathname}#s=${s}`;
      shareLinkInput.value = url;
    }

    function copyLink(){
      shareLinkInput.select();
      shareLinkInput.setSelectionRange(0,99999);
      navigator.clipboard.writeText(shareLinkInput.value).then(()=>alert('Ссылка скопирована'));
    }

    function createDraft(){
      updateShareLink();
      titleEl.focus();
      window.scrollTo({ top: 300, behavior: 'smooth' });
    }

    function scrollToGallery(){
      document.getElementById('gallery').scrollIntoView({behavior:'smooth'});
    }

    function downloadStatic(){
      applyFromDOM();
      const html = generateStaticHTML();
      const blob = new Blob([html], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'portfolio.html';
      a.click();
    }

    function generateStaticHTML(){
      const safe = str => str.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
      const title = safe(state.content.title);
      const subtitle = safe(state.content.subtitle);
      const about = safe(state.content.about);
      const email = safe(state.content.contacts.email);
      const github = safe(state.content.contacts.github);
      const website = safe(state.content.contacts.website);
      const seoTitle = safe(state.content.seo.title || title + ' — портфолио');
      const seoDesc = safe(state.content.seo.description || subtitle);
      const accent = state.colors.primary;
      const cardBg = state.colors.card;
      const textColor = state.colors.text;
      const projectsHTML = state.content.projects.map(p=>{
        const name = safe(p.name);
        const desc = safe(p.desc);
        const link = safe(p.link);
        const imgTag = p.image ? `<div style="margin-top:8px;"><img src="${p.image}" alt="${name}" style="border-radius:6px;max-width:100%;"></div>` : '';
        const linkHtml = link ? `<div style="margin-top:4px;"><a href="${link}" target="_blank">${link}</a></div>` : '';
        return `
          <div style="background:${cardBg};border-radius:8px;padding:14px;margin-bottom:14px;box-shadow:0 25px 50px -10px rgba(31,45,58,.08);">
            <div style="font-weight:600;font-size:1rem;">${name}</div>
            <div style="margin-top:6px;color:#555;">${desc}</div>
            ${imgTag}
            ${linkHtml}
          </div>
        `;
      }).join('');
      return `
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>${seoTitle}</title>
  <meta name="description" content="${seoDesc}" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --primary:${accent};
      --card-bg:${cardBg};
      --text:${textColor};
      font-family: system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
      background:#f5f7fa;
      color: var(--text);
    }
    *{box-sizing:border-box;}
    body{margin:0;padding:0;}
    .container{max-width:900px;margin:0 auto;padding:40px 16px;}
    h1{margin:0;font-size:2.2rem;font-weight:700;}
    .small{font-size:.9rem;color:#555;margin-top:6px;}
    .card{background:var(--card-bg);border-radius:10px;padding:16px;box-shadow:0 30px 60px -10px rgba(31,45,58,.08);margin-bottom:16px;}
    a{color:var(--primary);text-decoration:none;}
    .projects{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-top:8px;}
    .badge{background:var(--primary);color:#fff;padding:6px 14px;border-radius:999px;font-size:.8rem;display:inline-block;margin-bottom:8px;font-weight:600;}
  </style>
</head>
<body>
  <div class="container">
    <div style="margin-bottom:16px;">
      <div style="font-size:.85rem;color:#777;">Портфолио</div>
      <h1>${title}</h1>
      <div style="margin-top:4px;font-size:1rem;color:#555;">${subtitle}</div>
    </div>
    <div class="card">
      <div class="badge">О себе</div>
      <div class="small">${about}</div>
    </div>
    <div class="card">
      <div class="badge">Проекты</div>
      <div class="projects">
        ${projectsHTML}
      </div>
    </div>
    <div class="card">
      <div class="badge">Контакты</div>
      <div class="small">Email: ${email}</div>
      <div class="small">GitHub: ${github}</div>
      <div class="small">Website: ${website}</div>
    </div>
    <div style="margin-top:40px;font-size:.8rem;color:#888;text-align:center;">Сгенерировано с помощью InstantPortfolio. Без регистрации.</div>
  </div>
</body>
</html>
      `;
    }

    function escape(str){ return (str||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function filterTemplates(type){
      document.querySelectorAll('.template-filter button').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.template-filter button[data-filter="${type}"]`)?.classList.add('active');
      document.querySelectorAll('#templates .template-card').forEach(card=>{
        if(type==='all') card.style.display='block';
        else card.style.display = card.getAttribute('data-type') === type ? 'block' : 'none';
      });
    }

    // init load
    window.addEventListener('load', init);
    window.addEventListener('hashchange', ()=>{
      loadState();
      render();
      updateShareLink();
    });

    // helpers
    function show(selector){ return document.querySelector(selector); }
  </script>
</body>
</html>
